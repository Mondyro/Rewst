{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "functionAppName": {
      "type": "string",
      "defaultValue": "Rewst-PowerShell-Flow",
      "metadata": {
        "description": "The name of the Function App."
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "Central US",
      "allowedValues": [
        "East US",
        "West US",
        "North Europe",
        "Southeast Asia",
        "Australia East",
        "Central US",
        "East US 2",
        "West Europe"
      ],
      "metadata": {
        "description": "Location for all resources."
      }
    },
    "appInsightsResourceId": {
      "type": "string",
      "metadata": {
        "description": "The Resource ID of the Application Insights resource."
      }
    },
    "appInsightsInstrumentationKey": {
      "type": "string",
      "metadata": {
        "description": "The Instrumentation Key for Application Insights."
      }
    },
    "httpTriggerFunctionName": {
      "type": "string",
      "defaultValue": "PowerShell-HTTP-Trigger",
      "metadata": {
        "description": "The name of the HTTP trigger function."
      }
    },
    "githubRepoUrl": {
      "type": "string",
      "defaultValue": "https://github.com/Mondyro/Rewst/tree/main/Powershell",
      "metadata": {
        "description": "GitHub repository URL containing the PowerShell scripts and function code."
      }
    }
  },
  "variables": {
    "functionAppSku": {
      "tier": "Dynamic",  // This ensures the Consumption Plan (Dynamic) is used
      "name": "F1"        // The F1 SKU corresponds to the Consumption Plan
    }
  },
  "resources": [
    {
      "type": "Microsoft.Web/serverFarms",
      "apiVersion": "2024-04-01",
      "name": "[parameters('functionAppName')]",
      "location": "[parameters('location')]",
      "properties": {
        "name": "[parameters('functionAppName')]",
        "sku": {
          "name": "[variables('functionAppSku').name]",  // Using F1 SKU for Consumption Plan
          "tier": "[variables('functionAppSku').tier]",  // Dynamic tier for the Consumption Plan
          "capacity": 1
        }
      }
    },
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2024-04-01",
      "name": "[parameters('functionAppName')]",
      "location": "[parameters('location')]",
      "tags": {
        "hidden-link: /app-insights-resource-id": "[parameters('appInsightsResourceId')]",
        "hidden-link: /app-insights-instrumentation-key": "[parameters('appInsightsInstrumentationKey')]",
        "hidden-link: /app-insights-conn-string": "InstrumentationKey=[parameters('a
